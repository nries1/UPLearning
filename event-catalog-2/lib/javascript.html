<script>
function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance"); }

function _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }

window.addEventListener('load', function () {
  $(function () {
    $('[data-toggle="popover"]').popover();
  });
  $('#modal-vertical').modal({
    show: true
  });
});

var getMultiSelectValues = function getMultiSelectValues(input) {
  var options = _toConsumableArray(input.getElementsByTagName('OPTION'));

  return options.reduce(function (values, option) {
    if (option.selected) values.push(option.value);
    return values;
  }, []);
};

var fetchEvents = function fetchEvents(instances) {
  if (instances.length === 0) return;
  console.log("fetching event data for ".concat(instances));
  document.getElementById('main-spinner').style.display = '';
  document.getElementById('main-spinner-msg').innerHTML = 'Loading Events...';
  var withSuccess = google.script.run.withSuccessHandler(renderEvents);
  var withFailure = withSuccess.withFailureHandler(function (error) {
    console.log(error);
  });
  withFailure.getEvents(instances);
};

var renderEvents = function renderEvents(eventData) {
  document.getElementById('main-spinner').style.display = 'none';
  var parent = document.getElementById('event-container');
  parent.innerHTML = '';

  for (var i = 0; i < eventData.length; i++) {
    console.log(eventData[i][0]);
    parent.appendChild(eventCard(JSON.parse(eventData[i])));
  }
};

var eventCard = function eventCard(data) {
  //card container
  var container = htmlElement({
    className: 'card col-12 col-xl-5 event-card'
  });
  var header = htmlElement({
    className: 'card-header'
  });
  var headerContentContainer = htmlElement({
    className: 'header-content-container'
  });
  headerContentContainer.appendChild(htmlElement({
    innerHTML: data.borough_office
  }));
  headerContentContainer.appendChild(htmlElement({
    innerHTML: "Division of ".concat(data.division)
  })); //evnet card header

  var headerButtonsContainer = htmlElement({
    className: 'header-buttons-conainer'
  });
  headerButtonsContainer.appendChild(htmlElement({
    tag: 'A',
    className: 'btn btn-outline-primary btn-sm',
    innerHTML: 'More Info',
    href: data.event_page
  }));
  headerButtonsContainer.appendChild(htmlElement({
    tag: 'A',
    className: 'btn btn-primary btn-sm',
    innerHTML: 'Register',
    href: data.reg_url
  }));
  header.appendChild(headerContentContainer);
  header.appendChild(headerButtonsContainer);
  container.appendChild(header); //card body

  var body = htmlElement({
    className: 'card-body'
  });
  body.appendChild(htmlElement({
    tag: 'H5',
    className: 'card-title',
    innerHTML: data.title
  })); //Event date, time, location

  var eventDetailsContainer = htmlElement({
    className: 'event-details-container'
  });
  var datesContainer = htmlElement({
    className: 'event-sub-details-container'
  });
  datesContainer.appendChild(htmlElement({
    className: 'event-detail-icon',
    innerHTML: '<i class="material-icons">calendar_today</i>'
  }));
  datesContainer.appendChild(htmlElement({
    innerHTML: data.dates
  }));
  eventDetailsContainer.appendChild(datesContainer);
  var locationContainer = htmlElement({
    className: 'event-sub-details-container'
  });
  locationContainer.appendChild(htmlElement({
    className: 'event-detail-icon',
    innerHTML: '<i class="material-icons">location_city</i>'
  }));
  locationContainer.appendChild(htmlElement({
    innerHTML: data.location
  }));
  eventDetailsContainer.appendChild(locationContainer);
  var timesContainer = htmlElement({
    className: 'event-sub-details-container'
  });
  timesContainer.appendChild(htmlElement({
    className: 'event-detail-icon',
    innerHTML: '<i class="material-icons">access_time</i>'
  }));
  timesContainer.appendChild(htmlElement({
    innerHTML: data.times
  }));
  eventDetailsContainer.appendChild(timesContainer); //Event Description

  var eventDescriptionContainer = htmlElement({
    className: 'event-description-container'
  });
  eventDescriptionContainer.appendChild(htmlElement({
    innerHTML: '<b>About this event</b>'
  }));
  eventDescriptionContainer.appendChild(htmlElement({
    className: 'event-description',
    innerHTML: data.description
  }));
  body.appendChild(eventDetailsContainer);
  body.appendChild(eventDescriptionContainer);
  container.appendChild(body);
  return container;
};

function htmlElement(obj, parent) {
  if (obj.tag) {
    var element = document.createElement(obj.tag);
  } else {
    var element = document.createElement("DIV");
  }

  var keys = Object.keys(obj);
  keys.forEach(function (key) {
    if (key === "tag") {
      return;
    }

    if (key.indexOf("data-") !== -1) {
      element.setAttribute(key, obj[key]);
    } else if (key === "eventListener") {
      element.addEventListener(obj[key].event, obj[key]["function"]);
    } else {
      element[key] = obj[key];
    }
  });

  if (parent) {
    parent.appendChild(element);
  } else {
    return element;
  }
}
</script>